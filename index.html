<!DOCTYPE html>
<html>
<head>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous"/>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            color: #666666;
            background-color: #f7fafc;
            font-size: 16px;
            padding-bottom: 5rem;
        }

        .headline {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .header {
            background-color: white;
            padding: 1rem;
            padding-bottom: 2.5rem;
        }

        .header__grid {
            display: grid;
            grid-template-columns: repeat(1, minmax(0, 1fr));
            grid-template-rows: repeat(4, minmax(0, 1fr));
            gap: 1.5rem;
            max-width: 56rem;
        }

        .header__logo {
            height: 4rem;
        }

        .header__label {
            text-transform: uppercase;
            display: block;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
            font-weight: 600;
            color: #718096;
        }

        .content {
            padding: 1rem;
            width: 100%;
        }

        .content__grid {
            display: grid;
            grid-template-columns: repeat(12, minmax(0, 1fr));
            grid-template-rows: repeat(3, minmax(0, 1fr));
            max-width: 56rem;
            column-gap: 1rem;
            row-gap: 2.5rem;
            padding-top: 1rem;
            padding-bottom: 1rem;
        }

        .input {
            border-width: 1px;
            border-color: #cbd5e0;
            border-radius: 0.25rem;
            height: 2.5rem;
            width: 100%;
            padding-left: 0.5rem;
            padding-right: 0.5rem;
        }

        .bttn__primary {
            background-color: #606FC7;
            color: white;
            border-width: 1px;
            border-color: #606FC7;
            border-radius: 0.25rem;
            font-size: 1.125rem;
            padding-left: 1.25rem;
            padding-right: 1.25rem;
            padding-top: 0.75rem;
            padding-bottom: 0.75rem;
        }

        .bttn__primary:hover {
            background-color: #4c51bf;
        }

        .result {
            max-width: 56rem;
        }

        .divider {
            border-width: 1px;
            border-color: #cbd5e0;
            margin-top: 2.5rem;
            margin-bottom: 2.5rem;
            height: 0;
        }

        .col-12 {
            grid-column: span 12 / span 12;
        }

        .video-container {
            width: 100%;
            max-width: 640px;
            margin: 20px auto;
            position: relative;
        }

        #videoElement {
            width: 100%;
            border-radius: 8px;
            border: 2px solid #cbd5e0;
        }

        #canvas {
            display: none;
        }

        #overlayCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .prediction-overlay {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 600;
            display: none;
        }

        .codeblock {
            border-width: 1px;
            border-color: #cbd5e0;
            border-radius: 0.25rem;
            display: block;
            padding: 0.75rem;
            background-color: white;
            overflow-x: auto;
        }

        @media (min-width: 768px) {
            .header__grid {
                grid-template-columns: repeat(4, minmax(0, 1fr));
                grid-template-rows: repeat(1, minmax(0, 1fr));
            }
            .header__logo {
                grid-column: span 1 / span 1;
            }
        }
    </style>
</head>
<body>
    <form id="inputForm">
        <div class="header">
            <div class="header__grid">
                <img class="header__logo" src="https://uploads-ssl.webflow.com/5f6bc60e665f54545a1e52a5/6143750f1177056d60fc52d9_roboflow_logomark_inference.png" alt="Roboflow Inference">
                <div>
                    <label class="header__label" for="model">Model</label>
                    <input class="input" type="text" id="model" />
                </div>
                <div>
                    <label class="header__label" for="version">Version</label>
                    <input class="input" type="number" id="version" />
                </div>
                <div>
                    <label class="header__label" for="api_key">API Key</label>
                    <input class="input" type="text" id="api_key" />
                </div>
            </div>
        </div>
        <div class="content">
            <div class="video-container">
                <video id="videoElement" autoplay playsinline></video>
                <canvas id="canvas"></canvas>
                <div id="predictionOverlay" class="prediction-overlay"></div>
            </div>
            <div class="content__grid">
                <div class="col-12">
                    <button type="button" id="startWebcam" class="bttn__primary">Start Webcam</button>
                    <button type="button" id="captureFrame" class="bttn__primary" style="margin-left: 10px;" disabled>Capture and Analyze</button>
                </div>
            </div>
            <div class="result" id="resultContainer">
                <div class="divider"></div>
                <div class="result__header">
                    <h3 class="headline">Result</h3>
                </div>
                <pre id="output" class="codeblock">Inference results will appear here</pre>
            </div>
        </div>
    </form>

    <script>
        $(function() {
            $('#model').val("trashclassification-kdsop");
            $('#version').val("3");
            $('#api_key').val("bRmnAKSZ2431YDeNvfe8");

            let videoElement = document.getElementById('videoElement');
            let canvas = document.getElementById('canvas');
            let captureButton = document.getElementById('captureFrame');
            let startWebcamButton = document.getElementById('startWebcam');
            let predictionOverlay = document.getElementById('predictionOverlay');

            startWebcamButton.addEventListener('click', function() {
                if (videoElement.srcObject) {
                    stopWebcam();
                } else {
                    startWebcam();
                }
            });

            captureButton.addEventListener('click', function() {
                captureAndAnalyze();
            });

            function startWebcam() {
                navigator.mediaDevices.getUserMedia({ video: true })
                    .then(function(stream) {
                        videoElement.srcObject = stream;
                        startWebcamButton.textContent = 'Stop Webcam';
                        captureButton.disabled = false;
                        predictionOverlay.style.display = 'none';
                    })
                    .catch(function(error) {
                        console.error("Error accessing webcam:", error);
                        alert("Error accessing webcam. Please make sure you have granted camera permissions.");
                    });
            }

            function stopWebcam() {
                let stream = videoElement.srcObject;
                let tracks = stream.getTracks();
                tracks.forEach(track => track.stop());
                videoElement.srcObject = null;
                startWebcamButton.textContent = 'Start Webcam';
                captureButton.disabled = true;
                predictionOverlay.style.display = 'none';
            }

            function captureAndAnalyze() {
                canvas.width = videoElement.videoWidth;
                canvas.height = videoElement.videoHeight;
                let ctx = canvas.getContext('2d');
                ctx.drawImage(videoElement, 0, 0, canvas.width, canvas.height);
                
                let imageData = canvas.toDataURL('image/jpeg');
                infer(imageData);
            }

            function infer(base64image) {
                $('#output').html("Inferring...");
                $("#resultContainer").show();
                predictionOverlay.style.display = 'none';

                let settings = {
                    method: "POST",
                    url: `https://classify.roboflow.com/${$('#model').val()}/${$('#version').val()}?api_key=${$('#api_key').val()}`,
                    data: base64image,
                    error: function(xhr) {
                        $('#output').html("Error loading response. Check your API key, model, version, and other parameters then try again.");
                    }
                };

                $.ajax(settings).then(function(response) {
                    let formatted = JSON.stringify(response, null, 4);
                    $('#output').html(formatted);
                    
                    // Display prediction overlay
                    if (response.predictions && response.predictions.length > 0) {
                        const topPrediction = response.predictions[0];
                        const confidence = (topPrediction.confidence * 100).toFixed(1);
                        predictionOverlay.textContent = `${topPrediction.class}: ${confidence}%`;
                        predictionOverlay.style.display = 'block';
                    }
                });
            }
        });
    </script>
</body>
</html>